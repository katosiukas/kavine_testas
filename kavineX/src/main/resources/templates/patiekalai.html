
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Patiekalai</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/black-tie/jquery-ui.css">
	
		<style>
					/* formos stilius */
			label, input { display:block; }
			input.text { margin-bottom:12px; width:95%; padding: .4em; }
			fieldset { padding:0; border:0; margin-top:25px; }
			h1 { font-size: 1.2em; margin: .6em 0; }
			div#users-contain { width: 350px; margin: 20px 0; }
			div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
			div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
			.ui-dialog .ui-state-error { padding: .3em; }
			.validateTips { border: 1px solid transparent; padding: 0.3em; }
			
			.istrinti, .sistrinti {
				background-color: red;
			}
						
			.sudetis, .ssudetis {
				background-color: blue;
			}
			
			.prideti, .sprideti {
				background-color: green;
			}
			
			table, th, td {
				border: 2px solid black;
				
				background-color: #f1f1c1;
			}
			
			.pereiti {
				text-decoration: none;
				background-color: white;
				font-size: 18px;
				border-radius: 12px;
				color: black;
				border: 2px solid #4CAF50;
				box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
				padding: 4px 52px;
			}
			
			.itraukti {
				background-color: white;
				font-size: 16px;
				border-radius: 12px;
				color: black;
				border: 2px solid #4CAF50;
				box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
				width: 250px;
				height: 30px;
			}
			
		</style>
		
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
	
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" 
			integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" 
			crossorigin="anonymous">
	</script>
	
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		
		<!--script>		//kad netrugdytu gyventi
	
			hash = " ";
			while (hash != "21232f297a57a5a743894a0e4a801fc3") {	
				var name = prompt("Vartotojas:", "");	// admin :)
				var hash = CryptoJS.MD5(name);
			}
			alert("Welcome!");	

		</script-->
	
	<script>
	
	$(document).ready ( function() {
			
		var id_accessing;
		var id_add_pat;
						
		pasiimtiPatiekalus();
		
		function del_pat( id ) {
		
			params_str = 'id=' + id;  
		
			$.ajax(
				{
					url: "http://localhost:8080/restfull/del_pat?" + params_str
				}
			)
			.done( function( data ) {
				
				pasiimtiPatiekalus();
			});			
		}
		
		function pasiimtiPatiekalus() {
		
			$.ajax(
				{
					url: "http://localhost:8080/restfull/all_pat" 
															
				})
			
			.done(	function( data ) {
															
				res_str = '<table>'
					+ '<tr><th rowspan="2">ID</th><th rowspan="2">Pavadinimas</th><th colspan="2">TRUKMĖ</th></tr>'
					+ '<tr><th>ruošimo</th><th>kaitinimo</th><th>Kaina</th></tr>';
						
				for ( i = 0; i < data.length; i++) {
						
					res_str += '<tr class="s' + data [ i ].busena  + '" data-id="' + data [ i ].id  +'" >'
						+ '<td>' + data [ i ].id + '</td>' 
						+ '<td>' + data [ i ].pav + '</td>'
						+ '<td>' + data [ i ].trukme_ruosimo + '</td>'
						+ '<td>' + data [ i ].trukme_kaitinimo + '</td>'
						+ '<td>' + data [ i ].kaina + '</td>';
								
					res_str +=
						'<td><input type="button" class="istrinti" value="Ištrinti"></td>'
						+ '<td><input type="button" class="sudetis" value="Sudėtis"></td>'
					//	+ '<td><input type="button" class="prideti" value="Pridėti ingredienta"></td>'
					//	+ '<td><input type="button" class="pasalinti_i" value="Pašalinti ingredientą"></td>'
					//	+ '<td><input type="button" class="redaguoti_i" value="Redaguoti ingredientą"></td>'
				
					res_str += '</tr>';
											
				}
						
				res_str += '</table>'
				
					$( '#uzsakymai' ).html ( res_str );
						
					$( '.istrinti' ).on ( 'click', function() {
						
						$( this ).each ( function() {
								
							id_accessing = $( this ).parent( ).parent().data ( 'id' );
							ConfirmDialog('Ar tikrai nori ištrinti?');
								
						});
					});

					$( '.prideti' ).on ( 'click', function() {
						
						$( this ).each ( function() {
								
							id_add_pat = $( this ).parent( ).parent().data ( 'id' );
							
							$.ajax(
								{
									url: "http://localhost:8080/restfull/produktai" 
															
								})
			
							.done(	function( data ) {
							
								for ( i = 0; i < data.length; i++) {
	
									$( 'select#dropdown' ).append(  '<option value="' + data [ i ].id + '">' + data [ i ].pav + '</option>');
								}
								
							});
							
						dialog1.dialog( "open" );
								
						});
					});

				$( '.sudetis' ).on ( 'click', function() {
							
					patiekalo_id = $( this ).parent().parent().data( 'id' );
						
						$.ajax(
							{
								url: "http://localhost:8080/restfull/patiekalai?patiekalo_id="  + patiekalo_id 
															
							})
							
							.done(	function( data ) {
									
								if ( data.patiekalu_produktai.length > 0 ) {
									
									$( "#sudetis" ).dialog( "open" );
									
									patiekalas = data; 
																									
									if ( patiekalas.patiekalu_produktai.length > 0 ) {
										
										i=0;
										ingredientai=" ";
										
										while (i < patiekalas.patiekalu_produktai.length) {
											
											ingredientai = ingredientai + " " + patiekalas.patiekalu_produktai[i].produktai.pav + " " + patiekalas.patiekalu_produktai[i].kiekis + "</br>"
											i++;
										}
										
										$( '#sudetis' ).dialog({   //nusistatom dialogo lango pavadinima
											autoOpen: false,
											title: "Patiekalo: " + patiekalas.pav + " sudėtis:"
										});
									
										$( '#ingredientas' ).html ( ingredientai );
									
									}	
								}									
									
								if ( data.patiekalu_produktai.length == 0 ) {
									
									alert("Sitam patiekalui nera produktu!");
									
								}
							});
				});
			});
								
		}
		
		$( "#itraukti" ).on( "click", function() { dialog.dialog( "open" );	});
	
		function ConfirmDialog(message) {
			$('<div></div>').appendTo('body')
			.html('<div><h6>' + message + '?</h6></div>')
			.dialog({
			modal: true,
			title: 'Įspėjimas!',
			zIndex: 10000,
			autoOpen: true,
			width: 'auto',
			resizable: false,
			buttons: {
			Taip: function() {
          
				del_pat ( id_accessing, 'istrinti' );
				
				$(this).dialog("close");
				},
			
			Ne: function() {
				
				$(this).dialog("close");
				}
			},
			
			close: function(event, ui) {
			$(this).remove();
			}
			});
		};

		function addPat() {
		
			if ( $(pav).val().length == 0 ) {
		
				alert("Pavadinimo laukas tusčias!");
			}
			
			else if 	( $(trukme_ruosimo).val().length == 0 ) {
		
				alert("Trukmė ruošimo laukas tusčias!");
			}	
		 
			else if 	( $(trukme_kaitinimo).val().length == 0 ) {
		
				alert("Trukmė kaitinimo laukas tusčias!");
			}
		
			else if 	( $(kaina).val().length == 0 ) {
		
				alert("Kaina laukas tusčias!");
			}
		
			else {
			
				itrauktas = {
				pav: $( '#pav' ).val()
				, trukme_ruosimo: $( '#trukme_ruosimo' ).val() 
				, trukme_kaitinimo: parseInt ( $( '#trukme_kaitinimo' ).val() )
				, kaina: parseFloat ( $( '#kaina' ).val() )
				}
			
				params_str = 
				"pav="  + itrauktas.pav 
				+ '&trukme_ruosimo=' + itrauktas.trukme_ruosimo 
				+ '&trukme_kaitinimo=' + itrauktas.trukme_kaitinimo
				+ '&kaina=' + itrauktas.kaina
							
				$.ajax(
				{
					url: "http://localhost:8080/restfull/add_pat?" + params_str
				})
					
				.done( function( data ) {
				
					pasiimtiPatiekalus();
			
				});	
		
				dialog.dialog( "close" );	
			}
		}
	
		function addIng() {
			
			if ( !isNaN (parseInt ( $( '#dropdown' ).val() ))) {
			
				itrauktas = {	
				
				idp: parseInt ( $( '#dropdown' ).val() ) 
				, kiekisp: parseInt ( $( '#kiekisp' ).val() ) 
					
				}		
				
			}
 								
			params_str = 
				"patiekalo_id=" + id_add_pat
				+ '&produkto_id='  + itrauktas.idp 
				+ '&kiekis=' + itrauktas.kiekisp 
				
								
			$.ajax(
				{
					url: "http://localhost:8080/restfull/adding?" + params_str
				}
			)
			.done( function( data ) {
				
				pasiimtiPatiekalus();
			
			});	
		
		dialog1.dialog( "close" );	
		}
		
	
		dialog = $( "#dialog-form" ).dialog({
	
			autoOpen: false,
			height: 450,
			width: 350,
			modal: true,
			buttons: {
			"Įtraukti patiekalą": addPat,
			Uždaryti: function() {
			dialog.dialog( "close" );
			}
			},
		});
		
			
		dialog1 = $( "#dialog-form1" ).dialog({
		autoOpen: false,
		height: 300,
		width: 380,
		modal: true,
		buttons: {
        "Įtraukti ingredientą": addIng,
        Uždaryti: function() {
         dialog1.dialog( "close" );
        }
		},
		});	
		
		$( "#sudetis" ).dialog({
		
			autoOpen: false,
			show: {
			effect: "blind",
			duration: 300
			},
			hide: {
			effect: "explode",
			duration: 300
			},
			buttons: {
			"Pridėti": addIng,
			"Redaguoti": addIng,
			"Pašalinti": addIng,
			},
		});
			
	});
		
	$( function() {
    $( document ).tooltip();
	});
	
	
</script>

</head>

<body>

	<a href="http://localhost:8080/produktai" class="pereiti">Patiekalų puslapis</a></br>
	<p><label for="itraukti"></label><input class="itraukti" type="button" value="Įtraukti naują" id="itraukti" title="Įtraukti naują patiekalą."></p>
	
	<div id="dialog-form" title="Įtraukti patiekalą:">
	<p class="validateTips">Visi laukai privalomi!</p>
	<form id="f1">
    <fieldset>
		<label for="pav">Patiekalo pavadinimas</label>
		<input type="text" name="pav" id="pav" value=" " class="text ui-widget-content ui-corner-all">
	  
		<label for="email">Trukmė ruošimo</label>
		<input type="text" name="email" id="trukme_ruosimo" value=" " class="text ui-widget-content ui-corner-all">
	  
		<label for="mat_kiek">Trukmė kaitinimo</label>
		<input type="text" name="password" id="trukme_kaitinimo" value=" " class="text ui-widget-content ui-corner-all">
	  	    
		<label for="email">Kaina</label>
		<input type="text" name="email" id="kaina" value=" " class="text ui-widget-content ui-corner-all">
	  
	  <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </fieldset>
	</form>
	</div>
	
	<div id="dialog-form1" title="Įtraukti ingredientą">
	<form>
    <fieldset>
		   
		<label for="dropdown">Pasirink produkta</label>
		<select name="pavp" id="dropdown">
			<option value=""></option>
		</select>
		
      <label for="kiekisp">Kiekis</label>
      <input type="text" name="kiekisp" id="kiekisp"  class="text ui-widget-content ui-corner-all">
	               
      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </fieldset>
	</form>
	</div>	
	
	<div id="sudetis" >
		<p><div id="ingredientas" ></div></p>
	</div>
			
	<div id="message"></div>
	<div id="uzsakymai"></div>	

</body>
</html>